<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon_32.ico?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_16.ico?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    copycode: {"enable":true,"show_result":true,"style":null},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>



  <meta name="description" content="本文转载自：蚩尤后裔 https://blog.csdn.net/wangmx1993328/article/details/81510782  RocketMQ 简介 RocketMQ 是阿里巴巴在 2012 年开源的第三代分布式消息中间件 2018年9月，阿里巴巴将 RocketMQ 捐赠给 Apache 软件基金会作为开源项目 历年双11，RocketMQ 都承载着阿里巴巴生产系统100%">
<meta name="keywords" content="RocketMQ">
<meta property="og:type" content="article">
<meta property="og:title" content="RocketMQ分布式消息中间件 理论介绍[转载]">
<meta property="og:url" content="https://www.guitu18.com/post/2019/04/18/30.html">
<meta property="og:site_name" content="夜月归途">
<meta property="og:description" content="本文转载自：蚩尤后裔 https://blog.csdn.net/wangmx1993328/article/details/81510782  RocketMQ 简介 RocketMQ 是阿里巴巴在 2012 年开源的第三代分布式消息中间件 2018年9月，阿里巴巴将 RocketMQ 捐赠给 Apache 软件基金会作为开源项目 历年双11，RocketMQ 都承载着阿里巴巴生产系统100%">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://img.guitu18.com/markdown/dcca7540889ecf3febb88edb251abc49.png">
<meta property="og:image" content="https://img.guitu18.com/markdown/963c827af4f60794f37811963b8e8e3b.png">
<meta property="og:image" content="https://img.guitu18.com/markdown/02815b9ed1f99bde00cba16b36d878ae.png">
<meta property="og:image" content="https://img.guitu18.com/markdown/81d1ca04fe417b6de97ee033bcb8706a.png">
<meta property="og:image" content="https://img.guitu18.com/markdown/0d05775f9aa84a53f3024aae33233309.png">
<meta property="og:updated_time" content="2019-04-18T02:06:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RocketMQ分布式消息中间件 理论介绍[转载]">
<meta name="twitter:description" content="本文转载自：蚩尤后裔 https://blog.csdn.net/wangmx1993328/article/details/81510782  RocketMQ 简介 RocketMQ 是阿里巴巴在 2012 年开源的第三代分布式消息中间件 2018年9月，阿里巴巴将 RocketMQ 捐赠给 Apache 软件基金会作为开源项目 历年双11，RocketMQ 都承载着阿里巴巴生产系统100%">
<meta name="twitter:image" content="https://img.guitu18.com/markdown/dcca7540889ecf3febb88edb251abc49.png">





  
  
  <link rel="canonical" href="https://www.guitu18.com/post/2019/04/18/30">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>RocketMQ分布式消息中间件 理论介绍[转载] | 夜月归途</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?827f811db6b41b489d3e11e73a29f977";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">夜月归途</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">一个安静的小角落</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.guitu18.com/post/2019/04/18/30.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Guitu">
      <meta itemprop="description" content="用实力让情怀落地">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夜月归途">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">RocketMQ分布式消息中间件 理论介绍[转载]

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-18 10:06:29" itemprop="dateCreated datePublished" datetime="2019-04-18T10:06:29+08:00">2019-04-18</time>
            </span>
          

          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/学习/" itemprop="url" rel="index"><span itemprop="name">学习</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/学习/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/post/2019/04/18/30.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/post/2019/04/18/30.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
                 阅读次数： 
                <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
              </span>
            </span>
          

          

          <br>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span title="本文字数">4.6k</span>
            </span>
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span title="阅读时长">4 分钟</span>
            </span>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>本文转载自：蚩尤后裔 <a href="https://blog.csdn.net/wangmx1993328/article/details/81510782" target="_blank" rel="noopener">https://blog.csdn.net/wangmx1993328/article/details/81510782</a></p>
</blockquote>
<h2 id="RocketMQ-简介"><a href="#RocketMQ-简介" class="headerlink" title="RocketMQ 简介"></a>RocketMQ 简介</h2><ul>
<li>RocketMQ 是阿里巴巴在 2012 年开源的第三代分布式消息中间件</li>
<li>2018年9月，阿里巴巴将 RocketMQ 捐赠给 Apache 软件基金会作为开源项目</li>
<li>历年双11，RocketMQ 都承载着阿里巴巴生产系统100%的消息流转，以2017年双11为例， RocketMQ 完成了1.2万亿消息精准低延迟投递，交易峰值高达17万笔/秒。</li>
<li>目前有 100 多家公司和科研机构正在使用RocketMQ</li>
<li>Apache 上开源官方地址：<a href="https://rocketmq.apache.org/" target="_blank" rel="noopener">https://rocketmq.apache.org/</a></li>
<li>GitHub 托管地址：<a href="https://github.com/apache/rocketmq" target="_blank" rel="noopener">https://github.com/apache/rocketmq</a></li>
<li>阿里官方的介绍文档：<a href="http://jm.taobao.org/2017/01/12/rocketmq-quick-start-in-10-minutes/" target="_blank" rel="noopener">http://jm.taobao.org/2017/01/12/rocketmq-quick-start-in-10-minutes/</a></li>
</ul>
<p><img src="https://img.guitu18.com/markdown/dcca7540889ecf3febb88edb251abc49.png" alt="img"></p>
<h2 id="RocketMQ-特性"><a href="#RocketMQ-特性" class="headerlink" title="RocketMQ 特性"></a>RocketMQ 特性</h2><ul>
<li>RockatMQ 是一款分布式消息引擎</li>
<li>低延迟、高并发：99.6%以上的响应延迟在1毫秒以内</li>
<li>面向金融：满足跟踪和审计的高可用性</li>
<li>工业级适用：可确保万亿量级的消息发送</li>
<li>中立性：支持多种消息传递协议，如 JMS 和 OpenMessaging</li>
<li>性能可靠：给予足够的磁盘空间，消息可以累积存放而没有性能损失。</li>
<li>支持发布/订阅（Pub/Sub）和点对点（P2P）消息模型</li>
<li>在一个队列中可靠的先进先出（FIFO）和严格的顺序传递</li>
<li>支持拉（pull）和推（push）两种消息模式</li>
<li>单一队列百万消息的堆积能力</li>
<li>分布式高可用的部署架构，满足至少一次消息传递语义</li>
<li>提供 docker 镜像用于隔离测试和云集群部署</li>
<li>提供配置、指标和监控等功能丰富的 Dashboard</li>
</ul>
<a id="more"></a>

<h2 id="专业术语"><a href="#专业术语" class="headerlink" title="专业术语"></a>专业术语</h2><ul>
<li>RocketMQ 涉及的专有名词比较多，需要在实际开发中逐渐加深了解。</li>
</ul>
<h3 id="Producer"><a href="#Producer" class="headerlink" title="Producer"></a>Producer</h3><ul>
<li>Producer 消息生产者，生产者的作用就是将消息发送到 MQ（Message Queue）</li>
<li>消息生产者，负责产生消息，一般由业务系统负责产生消息。</li>
</ul>
<h3 id="Producer-Group"><a href="#Producer-Group" class="headerlink" title="Producer Group"></a>Producer Group</h3><ul>
<li>生产者组，简单来说就是多个发送同一类消息的生产者称之为一个生产者组，大家发送逻辑一致。</li>
</ul>
<h3 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h3><ul>
<li>Consumer 消息消费者，简单来说，消费 MQ 上的消息的应用程序就是消费者，至于消息是否进行逻辑处理，还是直接存储到数据库等取决于业务需要。</li>
<li>消息消费者，负责消费消息，一般是后台系统负责异步消费</li>
</ul>
<h3 id="Consumer-Group"><a href="#Consumer-Group" class="headerlink" title="Consumer Group"></a>Consumer Group</h3><ul>
<li>消费者组，和生产者类似，消费同一类消息的多个 consumer 实例组成一个消费者组，大家消费逻辑一致。</li>
</ul>
<p><img src="https://img.guitu18.com/markdown/963c827af4f60794f37811963b8e8e3b.png" alt="img"></p>
<ul>
<li>通过 Group 机制，让 RocketMQ 天然的支持消息负载均衡！比如某个Topic(主题)有9条消息，其中一个Consumer Group有3个实例（3个进程 OR 3台机器），那么每个实例将均摊3条消息！</li>
</ul>
<h3 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h3><ul>
<li><strong>Topic(主题) 是一种消息的逻辑分类</strong>，比如有订单类的消息，也有库存类的消息，那么就需要进行分类，一个是订单 Topic 存放订单相关的消息，一个是库存 Topic 存储库存相关的消息。</li>
</ul>
<h3 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h3><ul>
<li><strong>Message 是消息的载体</strong>，一个 Message 必须指定 topic，相当于寄信的地址。</li>
<li>Message 还有一个可选的 tag 设置，以便消费端可以基于 tag 进行过滤消息。也可以添加额外的键值对，例如你需要一个业务 key 来查找 broker（代理人/中间人） 上的消息，方便在开发过程中诊断问题。</li>
</ul>
<h3 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h3><ul>
<li>Tag (标签)可以被认为是对 Topic 进一步细化。一般在相同业务模块中通过引入标签来标记不同用途的消息。</li>
</ul>
<h3 id="Broker"><a href="#Broker" class="headerlink" title="Broker"></a>Broker</h3><ul>
<li>Broker（代理人/中间人） 是 RocketMQ 系统的主要角色，其实就是前面一直说的 MQ。</li>
<li>Broker 接收来自生产者的消息，储存以及为消费者拉取消息的请求做好准备。</li>
<li><strong>Broker  作为消息中转角色，负责存储消息，转发消息，一般也称为 Server</strong></li>
</ul>
<h3 id="Name-Server"><a href="#Name-Server" class="headerlink" title="Name Server"></a>Name Server</h3><ul>
<li>Name Server 为 producer 和 consumer 提供路由信息。</li>
</ul>
<h2 id="RocketMQ-物理部署结构"><a href="#RocketMQ-物理部署结构" class="headerlink" title="RocketMQ 物理部署结构"></a>RocketMQ 物理部署结构</h2><p><img src="https://img.guitu18.com/markdown/02815b9ed1f99bde00cba16b36d878ae.png" alt="img"></p>
<ul>
<li><p>从这架构图中可以看到它主要由四部分组成：Producer（生产者）、NameServer、Broker、Consumer（消费者）。</p>
</li>
<li><p>如上图所示， RocketMQ 的部署结构有以下特点：</p>
<blockquote>
<ol>
<li>Name Server 是一个几乎无状态节点，可集群部署，节点之间无任何信息同步。</li>
<li>Broker 部署相对复杂，Broker 分为 Master 与 Slave，一个 Master（主人） 可以对应多个 Slave(奴隶)，但是一个Slave只能对应一个Master，Master与Slave的对应关系通过指定相同的 BrokerName，不同的BrokerId来定义，BrokerId为0表示Master，非0表示Slave。Master也可以部署多个，每个Broker与Name Server集群中的所有节点建立长连接，定时注册Topic 信息到所有 Name Server。</li>
<li>Producer 与 Name Server 集群中的其中一个节点（随机选择）建立长连接，定期从Name Server取Topic路由信息，并向提供 Topic 服务的 Master 建立长连接，且定时向 Master 发送心跳。Producer完全无状态，可集群部署。</li>
<li>Consumer 与 Name Server 集群中的其中一个节点（随机选择）建立长连接，定期从Name Server取Topic路由信息，并向提供 Topic 服务的 Master、Slave 建立长连接，且定时向 Master、Slave发送心跳。Consumer既可以从Master订阅消息，也可以从Slave订阅消息，订阅规则由Broker配置决定。</li>
</ol>
</blockquote>
</li>
</ul>
<h3 id="Producer-1"><a href="#Producer-1" class="headerlink" title="Producer"></a>Producer</h3><ul>
<li>生产者支持分布式部署。分布式生产者通过多种负载均衡模式向 Broker 集群发送消息。发送过程支持快速失败并具有低延迟。</li>
</ul>
<h3 id="NameServer"><a href="#NameServer" class="headerlink" title="NameServer"></a>NameServer</h3><ul>
<li><p>提供轻量级服务和路由，每个 Name Server 记录完整的路由信息，提供相应的读写服务，支持快速存储扩展。主要包括两个功能：</p>
<blockquote>
<ol>
<li>代理管理，NameServer 接受来自 Broker 集群的注册，并提供检测代理是否存在的心跳机制。</li>
<li>路由管理，NameServer 将保存有关代理集群的全部路由信息以及客户端查询的队列信息。</li>
</ol>
</blockquote>
</li>
<li><p>RocketMQ 客户端(生产者/消费者)会从 NameServer 查询队列路由信息。客户端通过如下方式之一找到NameServer地址：</p>
<blockquote>
<ol>
<li>编程方式，如：producer.setNamesrvAddr(“ip:port”)</li>
<li>Java 选项，如：rocketmq.namesrv.addr</li>
<li>环境变量，如：NAMESRV_ADDR</li>
<li>HTTP 端点</li>
</ol>
</blockquote>
</li>
</ul>
<h3 id="Broker-1"><a href="#Broker-1" class="headerlink" title="Broker"></a>Broker</h3><p>  Broker 通过提供轻量级的 Topic 和 Queue 机制来进行消息存储。<br>  Broker 支持 Push 和 Pull 模式，包含容错机制，并且提供了强大的峰值填充和以原始时间顺序累计数千亿条消息的能力。<br>  Broker 还提供灾难恢复，丰富的指标统计数据和警报机制，而传统的消息传递系统都缺乏这些机制</p>
<h2 id="RocketMQ-逻辑部署结构"><a href="#RocketMQ-逻辑部署结构" class="headerlink" title="RocketMQ 逻辑部署结构"></a>RocketMQ 逻辑部署结构</h2><p><img src="https://img.guitu18.com/markdown/81d1ca04fe417b6de97ee033bcb8706a.png" alt="img"></p>
<p>如上图所示，RocketMQ 的逻辑部署结构有 Producer 和 Consumer 两个特点。</p>
<ul>
<li><p>Producer Group 用来表示一个发送消息应用，一个Producer Group下包含多个Producer实例，可以是多台机器，也可以是一台机器的多个进程，或者一个进程的多个Producer对象。一个 Producer Group 可以发送多个Topic消息。Producer Group作用如下：</p>
<blockquote>
<ol>
<li>标识一类 Producer</li>
<li>可以通过运维工具查询这个发送消息应用下有多个 Producer 实例</li>
<li>发送分布式事务消息时，如果 Producer 中途意外宕机，Broker 会主动回调 Producer Group 内的任意一台机器来确认事务状态。</li>
</ol>
</blockquote>
</li>
<li><p>Consumer Group 用来表示一个消费消息应用，一个Consumer Group下包含多个Consumer实例，可以是多台机器，也可以是多个进程，或者是一个进程的多个Consumer对象。一个Consumer Group下的多个Consumer以均摊方式消费消息，如果设置为广播方式，那么这个Consumer Group下的每个实例都消费全量数据。</p>
</li>
</ul>
<h2 id="RocketMQ-集群部署模式"><a href="#RocketMQ-集群部署模式" class="headerlink" title="RocketMQ 集群部署模式"></a>RocketMQ 集群部署模式</h2><p><img src="https://img.guitu18.com/markdown/0d05775f9aa84a53f3024aae33233309.png" alt="img"></p>
<ul>
<li>如上图所示， RocketMQ的部署结构有以下特点：<blockquote>
<ol>
<li>Name Server是一个几乎无状态节点，可集群部署，节点之间无任何信息同步。</li>
<li>Broker 部署相对复杂，Broker 分为 Master 与 Slave，一个 Master（主人） 可以对应多个 Slave(奴隶)，但是一个Slave只能对应一个Master，Master与Slave的对应关系通过指定相同的 BrokerName，不同的BrokerId来定义，BrokerId为0表示Master，非0表示Slave。Master也可以部署多个，每个Broker与Name Server集群中的所有节点建立长连接，定时注册Topic 信息到所有 Name Server。</li>
<li>Producer 与 Name Server 集群中的其中一个节点（随机选择）建立长连接，定期从Name Server取Topic路由信息，并向提供 Topic 服务的 Master 建立长连接，且定时向 Master 发送心跳。Producer完全无状态，可集群部署。</li>
<li>Consumer 与 Name Server 集群中的其中一个节点（随机选择）建立长连接，定期从Name Server取Topic路由信息，并向提供 Topic 服务的 Master、Slave 建立长连接，且定时向 Master、Slave发送心跳。Consumer既可以从Master订阅消息，也可以从Slave订阅消息，订阅规则由Broker配置决定。</li>
</ol>
</blockquote>
</li>
</ul>
<h3 id="单-master-模式"><a href="#单-master-模式" class="headerlink" title="单 master 模式"></a>单 master 模式</h3><ul>
<li>也就是只有一个 master 节点，称不上是集群，一旦这个 master 节点宕机，那么整个服务就不可用，适合个人学习使用。</li>
</ul>
<h3 id="多-master-模式"><a href="#多-master-模式" class="headerlink" title="多 master 模式"></a>多 master 模式</h3><ul>
<li>多个 master 节点组成集群，单个 master 节点宕机或者重启对应用没有影响。</li>
<li>优点：所有模式中性能最高</li>
<li>缺点：单个 master 节点宕机期间，未被消费的消息在节点恢复之前不可用，消息的实时性就受到影响。</li>
<li>注意：使用同步刷盘可以保证消息不丢失，同时 Topic 相对应的 queue 应该分布在集群中各个节点，而不是只在某各节点上，否则，该节点宕机会对订阅该 topic 的应用造成影响。</li>
</ul>
<h3 id="多-master-多-slave-异步复制模式"><a href="#多-master-多-slave-异步复制模式" class="headerlink" title="多 master 多 slave 异步复制模式"></a>多 master 多 slave 异步复制模式</h3><ul>
<li>在多 master 模式的基础上，每个 master 节点都有至少一个对应的 slave。</li>
<li>master 节点可读可写，但是 slave 只能读不能写，类似于 mysql 的主从模式。</li>
<li>优点： 在 master 宕机时，消费者可以从 slave 读取消息，消息的实时性不会受影响，性能几乎和多 master 一样。</li>
<li>缺点：使用异步复制的同步方式有可能会有消息丢失的问题。</li>
</ul>
<h3 id="多-master-多-slave-同步双写模式"><a href="#多-master-多-slave-同步双写模式" class="headerlink" title="多 master 多 slave 同步双写模式"></a>多 master 多 slave 同步双写模式</h3><ul>
<li>同多 master 多 slave 异步复制模式类似，区别在于 master 和 slave 之间的数据同步方式。</li>
<li>优点：同步双写的同步模式能保证数据不丢失。</li>
<li>缺点：发送单个消息 RT 会略长，性能相比异步复制低10%左右。</li>
<li>刷盘策略：同步刷盘和异步刷盘（指的是节点自身数据是同步还是异步存储）</li>
<li>同步方式：同步双写和异步复制（指的一组 master 和 slave 之间数据的同步）</li>
<li>注意：要保证数据可靠，需采用同步刷盘和同步双写的方式，但性能会较其他方式低。</li>
</ul>

      
    </div>

    

    
      
    

    
    
    

    

    
      
    
    
      <div>
        <div id="reward-container">
  <div>明人不说暗话，如果你觉得可以的话，你懂的！</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">

    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/wechatpay.jpg" alt="Guitu 微信支付">
        <p>微信支付</p>
      </div>
    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/alipay.jpg" alt="Guitu 支付宝">
        <p>支付宝</p>
      </div>
    

  </div>
</div>

      </div>
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Guitu</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="https://www.guitu18.com/post/2019/04/18/30.html" title="RocketMQ分布式消息中间件 理论介绍[转载]">https://www.guitu18.com/post/2019/04/18/30.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/RocketMQ/" rel="tag"># RocketMQ</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/post/2019/03/11/29.html" rel="next" title="源码学习系列：设计模式之单例模式">
                <i class="fa fa-chevron-left"></i> 源码学习系列：设计模式之单例模式
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/post/2019/04/18/31.html" rel="prev" title="RocketMQ分布式消息中间件-Centos7安装运行">
                RocketMQ分布式消息中间件-Centos7安装运行 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Guitu</p>
              <div class="site-description motion-element" itemprop="description">用实力让情怀落地</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">44</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">49</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.yangqq.com/" title="https://www.yangqq.com/" rel="noopener" target="_blank">杨青博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.python66.com/" title="http://www.python66.com/" rel="noopener" target="_blank">Python教程</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.jianhuax.com/" title="http://www.jianhuax.com/" rel="noopener" target="_blank">建华兄</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://haowenbo.com/" title="https://haowenbo.com/" rel="noopener" target="_blank">Easy Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://zhantianlun.github.io/" title="https://zhantianlun.github.io/" rel="noopener" target="_blank">湛天伦</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.ruanyifeng.com/blog/" title="http://www.ruanyifeng.com/blog/" rel="noopener" target="_blank">阮一峰</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.zsythink.net" title="http://www.zsythink.net" rel="noopener" target="_blank">朱双印</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.izgq.net" title="https://blog.izgq.net" rel="noopener" target="_blank">ZGQ's Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://crossoverjie.top" title="https://crossoverjie.top" rel="noopener" target="_blank">Jie's Blog</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.xukun.wang/" title="https://www.xukun.wang/" rel="noopener" target="_blank">徐坤博客</a>
                  </li>
                
              </ul>
            </div>
          

          
        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#RocketMQ-简介"><span class="nav-number">1.</span> <span class="nav-text">RocketMQ 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RocketMQ-特性"><span class="nav-number">2.</span> <span class="nav-text">RocketMQ 特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#专业术语"><span class="nav-number">3.</span> <span class="nav-text">专业术语</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Producer"><span class="nav-number">3.1.</span> <span class="nav-text">Producer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Producer-Group"><span class="nav-number">3.2.</span> <span class="nav-text">Producer Group</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Consumer"><span class="nav-number">3.3.</span> <span class="nav-text">Consumer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Consumer-Group"><span class="nav-number">3.4.</span> <span class="nav-text">Consumer Group</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Topic"><span class="nav-number">3.5.</span> <span class="nav-text">Topic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Message"><span class="nav-number">3.6.</span> <span class="nav-text">Message</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tag"><span class="nav-number">3.7.</span> <span class="nav-text">Tag</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Broker"><span class="nav-number">3.8.</span> <span class="nav-text">Broker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Name-Server"><span class="nav-number">3.9.</span> <span class="nav-text">Name Server</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RocketMQ-物理部署结构"><span class="nav-number">4.</span> <span class="nav-text">RocketMQ 物理部署结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Producer-1"><span class="nav-number">4.1.</span> <span class="nav-text">Producer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NameServer"><span class="nav-number">4.2.</span> <span class="nav-text">NameServer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Broker-1"><span class="nav-number">4.3.</span> <span class="nav-text">Broker</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RocketMQ-逻辑部署结构"><span class="nav-number">5.</span> <span class="nav-text">RocketMQ 逻辑部署结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RocketMQ-集群部署模式"><span class="nav-number">6.</span> <span class="nav-text">RocketMQ 集群部署模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单-master-模式"><span class="nav-number">6.1.</span> <span class="nav-text">单 master 模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多-master-模式"><span class="nav-number">6.2.</span> <span class="nav-text">多 master 模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多-master-多-slave-异步复制模式"><span class="nav-number">6.3.</span> <span class="nav-text">多 master 多 slave 异步复制模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多-master-多-slave-同步双写模式"><span class="nav-number">6.4.</span> <span class="nav-text">多 master 多 slave 同步双写模式</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Guitu</span>

  
      <span class="post-meta-divider">|</span>
      <!-- Run Time -->
      <span id="timeDate">载入天数...</span>
      <span id="times">载入时分秒...</span>
      <script>
          var now = new Date();
          function createTime() {
              var grt= new Date("2018-03-05 08:58:41");
              now.setTime(now.getTime()+250);
              days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
              hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
              if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
              mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
              seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
              snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
              document.getElementById("timeDate").innerHTML = "本站已运行 "+dnum+" 天 ";
              document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
          }
          setInterval("createTime()",250);
      </script>
      <span class="post-meta-divider">|</span>
      <span class="post-meta-item-icon">
        <i class="fa fa-area-chart"></i>
      </span>
      
        <span class="post-meta-item-text">站点总字数：</span>
      
      <span title="站点总字数">181k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">2:45</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a></div>




        
<span class="post-meta-divider">|</span>
<span class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
	访客数
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
	人次
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
	访问量
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
	次
  
</span>









        
      </div>
    </footer>

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  
  













  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/affix.js?v=7.2.0"></script>

  <script src="/js/schemes/pisces.js?v=7.2.0"></script>




  
  <script src="/js/scrollspy.js?v=7.2.0"></script>
<script src="/js/post-details.js?v=7.2.0"></script>



  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  

  

  
  

<script src="https://img.guitu18.com/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'Dyx2ULeNQtm8P7lmjhjOEWiW-MdYXbMMI',
    appKey: 'EvXMp4vOR9bPgmH6NP7IRIt7',
    placeholder: '看了那么久，说点什么呗',
    avatar: 'identicon',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn'
  });
</script>




  


  




  

  

  

  

  

  

  

  

  

  

  

  

  


  

</body>
</html>
